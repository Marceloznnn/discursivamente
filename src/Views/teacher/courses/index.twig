{% extends 'layouts/base.twig' %}

{% block title %}Painel de Cursos{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="/assets/css/pages/curso/aluno/index.css">
{% endblock %}

{% block content %}
  {# Cabe√ßalho com t√≠tulo e bot√£o de criar curso #}
  <div class="course-dashboard-header">
    <div class="dashboard-title-group">
      <h1 class="page-title">Painel de Cursos</h1>
      <p class="dashboard-subtitle">Gerencie, organize e acompanhe seus cursos com facilidade</p>
    </div>
    <a href="/teacher/courses/create" class="btn-primary btn-sm" aria-label="Criar novo curso">
      <i class="fas fa-plus-circle"></i> Criar Curso
    </a>
  </div>

  {# Formul√°rio de busca (mesmo padr√£o do aluno) #}
  <form method="get" action="/teacher/courses" class="search-form">
    <input
      type="text"
      name="q"
      placeholder="Pesquisar meus cursos"
      value="{{ q|e }}"
      class="search-input"
    />
    <button type="submit" class="btn-primary btn-sm">Buscar</button>
    {% if q %}
      <a href="/teacher/courses" class="btn-secondary btn-sm">Limpar</a>
    {% endif %}
  </form>

  {# Lista de cursos em cards (mesmo padr√£o do aluno) #}
  <ul class="course-list">
    {% for course in courses %}
      <li class="course-item">
        <img
          src="/assets/images/sliders/cursosimg.jpeg"
          alt="{{ course.getTitle() }}"
          class="course-img"
        >
        <div class="content">
          <a href="/teacher/courses/{{ course.getId() }}">
            <strong>{{ course.getTitle() }}</strong>
          </a>
          
          <div class="stats">
            <div class="participants">
              üë• {{ participantCounts[course.getId()] ?? 0 }}
              {{ (participantCounts[course.getId()] ?? 0) == 1
                 ? 'participante'
                 : 'participantes' }}
            </div>
            {% if courseRatings[course.getId()] %}
              <div class="rating">
                <span class="stars">
                  {% set rating = courseRatings[course.getId()].average_rating %}
                  {% for i in 1..5 %}
                    {% if i <= rating %}
                      ‚≠ê
                    {% else %}
                      ‚òÜ
                    {% endif %}
                  {% endfor %}
                </span>
                <span class="rating-text">
                  {{ courseRatings[course.getId()].average_rating }} ({{ courseRatings[course.getId()].total_ratings }})
                </span>
              </div>
            {% endif %}
          </div>
          
          <a href="/teacher/courses/{{ course.getId() }}" class="course-cta">
            Gerenciar Curso
          </a>
        </div>
      </li>
    {% else %}
      <li class="empty-state">
        {% if q %}
          Nenhum curso encontrado para "{{ q }}".
          <br>
          <a href="/teacher/courses/create" class="btn-primary btn-sm" style="margin-top: 10px;">
            <i class="fas fa-plus-circle"></i> Criar primeiro curso
          </a>
        {% else %}
          Voc√™ ainda n√£o criou nenhum curso.
          <br>
          <a href="/teacher/courses/create" class="btn-primary btn-sm" style="margin-top: 10px;">
            <i class="fas fa-plus-circle"></i> Criar primeiro curso
          </a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  {# Pagina√ß√£o (mesmo padr√£o do aluno) #}
  {% if totalPages > 1 %}
    <nav class="pagination">
      <ul>
        {% for p in 1..totalPages %}
          <li class="{{ p == currentPage ? 'active' : '' }}">
            <a href="/teacher/courses?page={{ p }}{% if q %}&q={{ q|url_encode }}{% endif %}">
              {{ p }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}