{# templates/profile/index.twig #}
{% extends 'layouts/base.twig' %}

{% block title %}Meu Perfil{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="/assets/css/pages/profile/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div id="profile-page" class="profile-pro">
  <div id="profile-card" class="profile-card-pro">
    <!-- Header com avatar e info -->
    <div id="profile-header" class="profile-header-pro">
      <div id="avatar-wrapper" class="avatar-wrapper-pro">
        <img
          id="profile-avatar"
          src="{{ user.avatar ?: '/assets/default-avatar.png' }}"
          alt="Avatar de {{ user.name }}"
        >
        <form id="avatar-form" action="/profile/avatar" method="post" enctype="multipart/form-data">
            <input type="file" id="avatar-upload" name="avatar" accept="image/*" onchange="this.form.submit()">
          </label>
        </form> 
      </div>
      <div id="user-info" class="user-info-pro">
        <h2 id="user-name">{{ user.name }}</h2>
        <p id="user-email"><i class="fas fa-envelope"></i> {{ user.email }}
          {% if user.email_verified %}
            <span class="verified" title="E-mail verificado"><i class="fas fa-check-circle"></i></span>
          {% else %}
            <span class="not-verified" title="E-mail não verificado"><i class="fas fa-exclamation-circle"></i></span>
          {% endif %}
        </p>
        <p id="user-type"><i class="fas fa-user-tag"></i> {{ user.type|capitalize }}</p>
        <p id="user-joined"><i class="fas fa-calendar-alt"></i> Membro desde {{ user.created_at|date('d/m/Y') }}</p>
        <p id="user-updated"><i class="fas fa-clock"></i> Última atualização: {{ user.updated_at|date('d/m/Y H:i') }}</p>
        {% if user.phone %}
          <p id="user-phone"><i class="fas fa-phone"></i> {{ user.phone }}</p>
        {% endif %}
        <div class="profile-socials">
          {% if user.linkedin %}<a href="{{ user.linkedin }}" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>{% endif %}
          {% if user.instagram %}<a href="{{ user.instagram }}" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>{% endif %}
          {% if user.facebook %}<a href="{{ user.facebook }}" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a>{% endif %}
        </div>
      </div>
    </div>

    <!-- Estatísticas -->
    <section id="profile-stats" class="profile-stats-pro">
      <h3>Estatísticas</h3>
      <ul>
        {% if user.type == 'professor' %}
          <li><i class="fas fa-chalkboard-teacher"></i> Cursos criados: <strong>{{ user.courses_created|default(0) }}</strong></li>
        {% elseif user.type == 'aluno' %}
          <li><i class="fas fa-graduation-cap"></i> Cursos participando: <strong>{{ user.courses_participating|default(0) }}</strong></li>
        {% endif %}
      </ul>
    </section>

    <!-- Biografia -->
    <section id="profile-bio" class="profile-bio-pro">
      <h3><i class="fas fa-info-circle"></i> Biografia</h3>
      <p>{{ user.bio ?: 'Ainda não adicionou uma biografia.' }}</p>
    </section>

    <!-- Ações -->
    <div id="profile-actions" class="profile-actions-pro">
      <a href="/profile/edit" id="btn-edit" class="btn-pro"><i class="fas fa-edit"></i> Editar Perfil</a>
      <a href="/logout" id="btn-logout" class="btn-pro btn-logout-pro"><i class="fas fa-sign-out-alt"></i> Sair</a>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function confirmDeactivate() {
  document.getElementById('deactivate-modal').style.display = 'block';
}
function closeModal() {
  document.getElementById('deactivate-modal').style.display = 'none';
}
</script>
{% endblock %}