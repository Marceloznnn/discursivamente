{% extends 'layouts/base.twig' %}

{% block styles %}
  <link rel="stylesheet" href="/assets/css/pages/curso/aluno/index.css">
{% endblock %}

{% block content %}

  {# Formul√°rio de busca #}
  <form method="get" action="/courses" class="search-form">
    <input
      type="text"
      name="q"
      placeholder="Pesquisar cursos"
      value="{{ q|e }}"
      class="search-input"
    />
    <button type="submit" class="btn-primary btn-sm">Buscar</button>
    {% if q %}
      <a href="/courses" class="btn-secondary btn-sm">Limpar</a>
    {% endif %}
  </form>

  {# Lista de cursos em cards, ordenados pelos crit√©rios definidos no controller #}
  <ul class="course-list">
    {% for course in courses %}
      <li class="course-item">
        <img
          src="/assets/images/sliders/cursosimg.jpeg"
          alt="{{ course.getTitle() }}"
          class="course-img"
        >
        <div class="content">
          <a href="/courses/{{ course.getId() }}">
            <strong>{{ course.getTitle() }}</strong>
          </a>

          <div class="stats">
            <div class="participants">
              üë• {{ participantCounts[course.getId()] }}
              {{ participantCounts[course.getId()] == 1
                 ? 'participante'
                 : 'participantes' }}
            </div>
            <div class="rating">
              <span class="stars">
                {% set rating = courseRatings[course.getId()].average_rating %}
                {% for i in 1..5 %}
                  {% if i <= rating %}
                    ‚≠ê
                  {% else %}
                    ‚òÜ
                  {% endif %}
                {% endfor %}
              </span>
              <span class="rating-text">
                {{ courseRatings[course.getId()].average_rating }} ({{ courseRatings[course.getId()].total_ratings }})
              </span>
            </div>
          </div>

          <a href="/courses/{{ course.getId() }}" class="course-cta">
            Saiba mais
          </a>
        </div>
      </li>
    {% else %}
      <li class="empty-state">
        Nenhum curso {{ q
          ? 'encontrado para "' ~ q ~ '"'
          : 'dispon√≠vel' }}.
      </li>
    {% endfor %}
  </ul>

  {# Pagina√ß√£o #}
  {% if totalPages > 1 %}
    <nav class="pagination">
      <ul>
        {% for p in 1..totalPages %}
          <li class="{{ p == currentPage ? 'active' : '' }}">
            <a href="/courses?page={{ p }}{% if selectedCategory %}&category_id={{ selectedCategory }}{% endif %}{% if q %}&q={{ q|url_encode }}{% endif %}">
              {{ p }}
            </a>
          </li>
        {% endfor %}
      </ul> 
    </nav>
  {% endif %}

{% endblock %}