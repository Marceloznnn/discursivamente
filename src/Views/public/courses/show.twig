{% extends 'layouts/base.twig' %}

{% block styles %}
  <link rel="stylesheet" href="/assets/css/pages/curso/aluno/show.css">
{% endblock %}

{% block content %}
  <div class="course-detail-container">
    <h1>{{ course.title }}</h1>
    <p class="course-description">{{ course.description }}</p>

    {# N√∫mero de participantes ativos #}
    <p class="participant-count">
      üë• {{ participantCount }}
      {{ participantCount == 1
         ? 'participante ativo'
         : 'participantes ativos' }}
    </p>

    {% if session.user %}
      {% if isParticipating %}
        <form action="/courses/{{ course.id }}/leave" method="post" class="action-form">
          <button type="submit" class="btn-quit">Sair do curso</button>
        </form>
        <a href="/courses/{{ course.id }}/materials" class="btn-materials">
          Ver Materiais ({{ materials|length }})
        </a>
      {% else %}
        <form action="/courses/{{ course.id }}/join" method="post" class="action-form">
          <button type="submit" class="btn-join">Participar do curso</button>
        </form>
      {% endif %}
    {% else %}
      <p>
        <a href="/login" class="btn-login">
          Fa√ßa login para participar
        </a>
      </p>
    {% endif %}

    <div class="comments-section">
      <h2 id="comments">Coment√°rios</h2>
      <ul class="comments-list">
        {% for c in comments %}
          <li class="comment-item">
            <div class="comment-header">
              <strong>{{ c.userName }}</strong>
              <span>{{ c.createdAt|date("d/m/Y H:i") }}</span>
            </div>
            <div class="comment-rating">Avalia√ß√£o: {{ c.rating }} / 5</div>
            <div class="comment-body">{{ c.comment }}</div>
          </li>
        {% else %}
          <li class="material-empty">Seja o primeiro a comentar!</li>
        {% endfor %}
      </ul>

      {% if session.user %}
        <form action="/courses/{{ course.id }}/comment" method="post" class="comment-form">
          <label for="comment">Coment√°rio:</label>
          <textarea id="comment" name="comment" rows="4"></textarea>

          <label for="rating">Avalia√ß√£o:</label>
          <select id="rating" name="rating">
            {% for i in 1..5 %}
              <option value="{{ i }}">{{ i }} estrela{{ i > 1 ? 's' : '' }}</option>
            {% endfor %}
          </select>

          <button type="submit" class="btn-submit">Enviar coment√°rio</button>
        </form>
      {% else %}
        <p>
          <a href="/login" class="back-link">
            Fa√ßa login para deixar um coment√°rio.
          </a>
        </p>
      {% endif %}
    </div>

    <p>
      <a href="/courses" class="back-link">‚Üê Voltar a todos os cursos</a>
    </p>
  </div>
{% endblock %}
