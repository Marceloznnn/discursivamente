{% extends 'layouts/base.twig' %}

{% block styles %}
  <link rel="stylesheet" href="/assets/css/pages/curso/aluno/show.css">
{% endblock %}

{% block content %}
  <div class="course-page">

    <!-- Cabeçalho do Curso -->
    <section class="course-header">
      <h1 class="course-title">{{ course.title }}</h1>
      <p class="course-description">{{ course.description }}</p>
    </section>

    <!-- Ações de Participação -->
    <section class="course-actions">
      <div class="action-buttons">
        {% if session.user %}
          {% if isParticipating %}
            <form action="/courses/{{ course.id }}/leave" method="post" class="action-form">
              <button type="submit" class="button-exit">
                Sair do curso
              </button>
            </form>
            <div class="button-group">
              <a href="/courses/{{ course.id }}/modules" class="button-materials">
                Ver Módulos
              </a>
              <a href="/courses/{{ course.id }}/forum" class="button-forum">
                <i class="fas fa-comments"></i> Fórum de Discussão
              </a>
            </div>
          {% else %}
            <form action="/courses/{{ course.id }}/join" method="post" class="action-form">
              <button type="submit" class="button-join">
                Participar do curso
              </button>
            </form>
          {% endif %}
        {% else %}
          <button class="button-disabled" disabled>
            Faça login para participar
          </button>
        {% endif %}
      </div>
    </section>

    <!-- Avaliação do Curso -->
    <section class="course-rating-section">
      <h2>Média de Avaliação</h2>
      {% if ratingData.total_ratings > 0 %}
        <div class="course-rating-stars">
          {% set avg = ratingData.average_rating %}
          {% for i in 1..5 %}
            {% if i <= avg|round(0, 'floor') %}
              <span class="star filled">★</span>
            {% elseif i - avg < 1 and i > avg %}
              <span class="star half">★</span>
            {% else %}
              <span class="star">☆</span>
            {% endif %}
          {% endfor %}
          <span class="rating-value">{{ avg|number_format(1, ',', '.') }} / 5</span>
          <span class="rating-count">({{ ratingData.total_ratings }} avaliações)</span>
        </div>
      {% else %}
        <p class="no-rating">Ainda não há avaliações para este curso.</p>
      {% endif %}
    </section>

    <div class="back-link">
      <a href="/courses">← Voltar a todos os cursos</a>
    </div>

  </div>
{% endblock %}

{% block scripts %}
{% endblock %}
